<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Police OT Calc</title>
  <style>
    :root{--bg:#f2f2f7;--card:#ffffff;--primary:#0a84ff;--text:#111;--muted:#8e8e93;}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial;background:var(--bg);margin:0;padding:16px;color:var(--text);}    
    .card{background:var(--card);max-width:430px;margin:0 auto 16px;padding:20px;border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.08);}    
    h1,h2{text-align:center;margin:8px 0;}
    label{display:block;margin-top:12px;font-weight:600;font-size:.9rem;}
    select,input,button{width:100%;padding:12px;margin-top:6px;border-radius:12px;border:1px solid #ddd;font-size:1rem;}
    button{background:var(--primary);color:#fff;border:none;margin-top:12px;font-weight:600;}
    .row{display:flex;justify-content:space-between;margin:6px 0;font-size:.95rem;}
    .result{margin-top:16px;background:#f5f5f7;padding:12px;border-radius:14px;}
    .entry{background:#fff;padding:10px;border-radius:12px;margin-top:8px;}
  </style>
</head>
<body>

<div class="card">
  <h1>Police OT</h1>

  <label>Force</label>
  <select id="force">
    <option value="met">Metropolitan Police</option>
    <option value="other">Other HO Force</option>
  </select>

  <label>Rank</label>
  <select id="rank"></select>

  <label>Pay Point</label>
  <select id="payPoint"></select>

  <label>Warrant Number</label>
  <input id="warrant" placeholder="e.g. 123456" />

  <label>Date</label>
  <input type="date" id="otDate" />

  <label>Hours Worked</label>
  <input type="number" id="hours" value="9" min="0" />

  <label>Overtime Type</label>
  <select id="otType">
    <option value="1.3333">Standard (1⅓)</option>
    <option value="1.5">Rest Day (1½)</option>
    <option value="2">Cancelled RD (Double)</option>
  </select>

  <div class="result">
    <div class="row"><span>Base Hourly</span><strong>£<span id="base">0.00</span></strong></div>
    <div class="row"><span>OT Hourly</span><strong>£<span id="ot">0.00</span></strong></div>
    <div class="row"><span>Gross</span><strong>£<span id="gross">0.00</span></strong></div>
    <div class="row"><span>Tax & NI</span><strong>-£<span id="deductions">0.00</span></strong></div>
    <div class="row"><span>Net Pay</span><strong>£<span id="net">0.00</span></strong></div>
  </div>

  <button id="save">Save Overtime</button>
</div>

<div class="card">
  <h2>Overtime Log</h2>
  <select id="viewMode">
    <option value="day">By Day</option>
    <option value="week">By Week</option>
    <option value="month">By Month</option>
    <option value="year">By Year</option>
  </select>
  <div id="log"></div>
</div>

<script>
const WEEKLY_HOURS = 40;
const STORE_KEY = 'police_ot_entries';

const PAY = {
  met:{
    pc:{1:31646,2:32472,3:33789,4:35106,5:37737,6:43038,7:50256},
    ps:{2:53568,3:54660,4:56208}
  },
  other:{
    pc:{1:31646,2:32472,3:33789,4:35106,5:37737,6:43038,7:50256},
    ps:{2:53568,3:54660,4:56208}
  }
};

const forceEl=force, rankEl=rank, pointEl=payPoint, hoursEl=hours, otTypeEl=otType;
const baseEl=base, otEl=ot, grossEl=gross, deductionsEl=deductions, netEl=net;

function loadRanks(){
  rankEl.innerHTML='';
  ['pc','ps'].forEach(r=>rankEl.add(new Option(r.toUpperCase(),r)));
  loadPayPoints();
}

function loadPayPoints(){
  pointEl.innerHTML='';
  Object.keys(PAY[forceEl.value][rankEl.value]).forEach(p=>pointEl.add(new Option(p,p)));
  calculate();
}

function calculate(){
  const annual = PAY[forceEl.value][rankEl.value][pointEl.value];
  if(!annual) return;
  const base = annual/52/WEEKLY_HOURS;
  const otRate = base * Number(otTypeEl.value);
  const hrs = Number(hoursEl.value)||0;
  const gross = otRate * hrs;
  const higher = annual > 50270;
  const ded = gross * ((higher?0.4:0.2)+(higher?0.02:0.08));
  const net = gross - ded;
  baseEl.textContent = base.toFixed(2);
  otEl.textContent = otRate.toFixed(2);
  grossEl.textContent = gross.toFixed(2);
  deductionsEl.textContent = ded.toFixed(2);
  netEl.textContent = net.toFixed(2);
}

function getEntries(){return JSON.parse(localStorage.getItem(STORE_KEY)||'[]');}
function setEntries(e){localStorage.setItem(STORE_KEY,JSON.stringify(e));}

save.onclick=()=>{
  const entries=getEntries();
  entries.push({
    date: otDate.value,
    hours: Number(hoursEl.value),
    net: Number(netEl.textContent)
  });
  setEntries(entries);
  renderLog();
};

function renderLog(){
  log.innerHTML='';
  getEntries().forEach(e=>{
    log.innerHTML+=`<div class='entry'>${e.date} • ${e.hours}h • £${e.net.toFixed(2)}</div>`;
  });
}

force.onchange=loadRanks;
rank.onchange=loadPayPoints;
payPoint.onchange=calculate;
hours.oninput=calculate;
otType.onchange=calculate;

window.onload=()=>{otDate.valueAsDate=new Date();loadRanks();renderLog();};
</script>
</body>
</html>
